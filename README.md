# IDAO-2021 qualifying round Kirill Rybkin
## Задача
Задача - классифицировать изображения воздействия высокоэнергетических частиц на детектор. Классы: 2 вида частиц, и каждая из них может иметь одно из 6 значений энергий. 

<div align="center">
  <img src="https://github.com/Oxonomy/IDAO-2021-Kirill/blob/main/0.jpg" width="400" height="400">
  
  2 вида частиц (ER и NR), для каждой 6 значений энергий.
</div>

Для обучения даются только 3 вида энергий для каждого класса, по ним же рассчитывается публичный счет во время соревнования, а приватный счет считается по 3 классам энергий, которых нет в обучающей выборке. Это сделано для проверки на качество работы модели.

<div align="center">
  <img src="https://github.com/Oxonomy/IDAO-2021-Kirill/blob/main/1.png" width="400" height="400">
  
  Разделение частиц на обучающую (L) и тестовувю (T) выборки.
</div>


## В чем особенность данных, или почему сверточные сети не помогут решить задачу?
Прежде всего стоит вспомнить, что мы работаем с проекциями 3-х мерных результатов реакций взаимодействия высокоэнергетической частицы на плоскость. Об этом говорится в видео-лекции по соревнованию, да и в описании соревнования об этом есть информация. Нам нужно классифицировать изображения на 2 класса видов частиц и на 3 класса энергий.

Если не вдаваться в детали процесса формирования изображения, то пятно сформировано из нескольких тысяч точек/фотонов, положение которых определяется нормальным случайным распределением, а значения ‘яркости’ геометрическим распределением (причем сумма их яркостей равна энергии изначальной частицы). Эти точки суммируются попиксельно и формируют пятно. (Может показаться, что изображения с ER 10, 20 и 30 имеют другую природу, но скорее всего там просто пятно размазано по треку).

Можно предположить, что сам процесс взаимодействия частицы с веществом по большей части случаен, а значит и результат взаимодействия в виде изображения сохранит в себе эту случайность. Форма пятна (его радиус) и скорость падения 'яркости' от центра пятна к краям не случайны и зависят от типа частицы, яркость зависит от типа энергии частицы, но вот распределение позиций точек в пятне и их энергии абсолютно случайно.

И может показаться что все предельно просто, и для определения типа частицы достаточно ее радиус посчитать, а для энергии и вовсе просто просуммировать пиксели пятна, вычев из них шум. И да, применив примитивную фильтрацию и сложив яркости пикселей в ядре действительно получается очень точно определять энергию частицы (точность классификации 100%). Однако есть проблема с определением типа частицы. Очень легко можно выделить частицы с длинным треком или даже просто со смещением от центра, а так-как смещение есть только у ER 10, 20, 30 определение их класса не является проблемой. Но вот отличить частицы ER 1 и 3 от NR 1, 3, 6 вызывает проблемы (точность по roc_auc_score=0.9993). Причина как раз в том, что имея столь малую суммарную энергию шумы начинают вносить серьезную ошибку в определение параметров пятна.


## Как происходит определение параметров пятна для последующей классификации?
Прежде всего нужно уточнить, что речь идет о классификации именно круглых пятен, так как треки можно без проблем классифицировать и без определения их характеристик. Итак, у нас есть два вида пятен, и по изображению без шума снизу можно легко заметить, что они немного отличаются размерами и, что более важно, скоростью снижения яркости от ценра пятна к краям:

<div align="center">
  <img src="https://github.com/Oxonomy/IDAO-2021-Kirill/blob/main/2.jpg" width="600" height="300">
  
  <img src="https://github.com/Oxonomy/IDAO-2021-Kirill/blob/main/3.jpg" width="600" height="300">
  
  Пятна частиц без шума из видео-лекции по соревнованию (https://youtu.be/VzH_58yYz5k?t=2060)
</div>


Именно эти характеристики я и пытаюсь выделить с помощью функции get_height_map. В ней изображение разрезается на 30 фрагментов, в виде кругов разного радиуса, и для каждого из них считается среднее значение. Таким образом я получаю что-то вроде топографической карты высот, но так как мы знаем, что пятно - это круг, вместо 2d карты у нас график изменения средней высоты для каждого из значений радиуса.

<div align="center">
  <img src="https://github.com/Oxonomy/IDAO-2021-Kirill/blob/main/4.jpg" width="500" height="400">
  
  Карта высот 
</div>

### Пример масок изображения, по которым идет усреднение высоты:
<div align="center">
  <img src="https://github.com/Oxonomy/IDAO-2021-Kirill/blob/main/5.png" width="900" height="300">
</div>

### Результаты работы функции get_height_map для частиц ER3 и NR6:
Как можно заметить, после сглаживания изображения, для минимизации шумов и нормализации по максимуму частицы дают достаточно сильно отличающиеся графики изменения высоты от центра к краю пятна.
<div align="center">
  <img src="https://github.com/Oxonomy/IDAO-2021-Kirill/blob/main/6.png" width="500" height="500">
</div>

